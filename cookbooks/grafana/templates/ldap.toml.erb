#
# This file was generated by Chef
# Do not modify this file by hand!
#
# full documentation: http://docs.grafana.org/installation/configuration/
#

<% if @grafana['ldap']['log_filters'] %>
# To troubleshoot and get more log info enable ldap debug logging in grafana.ini
[log]
filters = <%= @grafana['ldap']['log_filters'] %>
<% end %>

<% unless @grafana['ldap']['servers'].nil? %>
<% @grafana['ldap']['servers'].each do | key, server | %>
# Map ldap groups to grafana org roles
[[servers]]
# Ldap server host (specify multiple hosts space separated)
host = "<%= key %>"
<% unless server['port'].nil? -%>
port = <%= server['port'] %>
<% end -%>
<% unless server['use_ssl'].nil? -%>
use_ssl = <%= server['use_ssl'] %>
<% end -%>
<% unless server['start_tls'].nil? -%>
start_tls = <%= server['start_tls'] %>
<% end -%>
<% unless server['ssl_skip_verify'].nil? -%>
ssl_skip_verify = <%= server['ssl_skip_verify'] %>
<% end -%>

<% unless server['root_ca_cert'].nil? -%>
root_ca_cert = "<%= server['root_ca_cert'] %>"
<% end -%>
<% unless server['client_cert'].nil? -%>
client_cert = "<%= server['client_cert'] %>"
<% end -%>
<% unless server['client_key'].nil? -%>
client_key = "<%= server['client_key'] %>"
<% end -%>

<% unless server['bind_dn'].nil? -%>
bind_dn = "<%= server['bind_dn'] %>"
<% end -%>
<% unless server['bind_password'].nil? -%>
bind_password = "<%= server['bind_password'] %>"
<% end -%>

<% unless server['search_filter'].nil? -%>
search_filter = "<%= server['search_filter'] %>"
<% end -%>
<% unless server['search_base_dns'].nil? -%>
search_base_dns = <%= server['search_base_dns'] %>
<% end -%>

<% unless server['group_search_filter'].nil? -%>
group_search_filter = "<%= server['group_search_filter'] %>"
<% end -%>
<% unless server['group_search_base_dns'].nil? -%>
group_search_base_dns = <%= server['group_search_base_dns'] %>
<% end -%>
<% unless server['group_search_filter_user_attribute'].nil? -%>
group_search_filter_user_attribute = "<%= server['group_search_filter_user_attribute'] %>"
<% end -%>
<% end # servers loop -%>
<% end # servers unless -%>

# Specify names of the ldap attributes your ldap uses
[servers.attributes]
<% if @grafana['ldap']['servers_attributes_name'] %>
name = "<%= @grafana['ldap']['servers_attributes_name'] %>"
<% end %>
<% if @grafana['ldap']['servers_attributes_surname'] %>
surname = "<%= @grafana['ldap']['servers_attributes_surname'] %>"
<% end %>
<% if @grafana['ldap']['servers_attributes_username'] %>
username = "<%= @grafana['ldap']['servers_attributes_username'] %>"
<% end %>
<% if @grafana['ldap']['servers_attributes_member_of'] %>
member_of = "<%= @grafana['ldap']['servers_attributes_member_of'] %>"
<% end %>
<% if @grafana['ldap']['servers_attributes_email'] %>
email = "<%= @grafana['ldap']['servers_attributes_email'] %>"
<% end %>

# Map ldap groups to grafana org roles
<% unless @grafana['ldap']['group_mappings'].nil? %>
<% @grafana['ldap']['group_mappings'].each do | key, group | %>

[[servers.group_mappings]]
group_dn = "<%= key %>"
<% unless group['org_role'].nil? -%>
org_role = "<%= group['org_role'] %>"
<% end -%>
<% unless group['org_id'].nil? -%>
org_id = <%= group['org_id'] %>
<% end -%>
<% unless group['grafana_admin'].nil? -%>
grafana_admin = <%= group['grafana_admin'] %>
<% end -%>
<% end # group_mappings loop -%>
<% end # group_mappings unless -%>
